name: CI

on:
  pull_request:
  push:
    branches:
      - main

concurrency:
  group: ci-${{ github.ref }}
  cancel-in-progress: true

jobs:
  lint:
    name: lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Repo hygiene checks
        shell: bash
        run: |
          set -euo pipefail

          test -f README.md
          test -f .gitignore
          test -f .github/workflows/ci.yml

          grep -q "^exports/$" .gitignore
          grep -q "^evidence/$" .gitignore
          grep -q "^node_modules/$" .gitignore || true
          grep -q "^app/node_modules/$" .gitignore || true

          if git ls-files | grep -E '^app/node_modules/|^node_modules/'; then
            echo "ERROR: node_modules is tracked in git"
            exit 1
          fi

          echo "OK: repo hygiene"

  typecheck:
    name: typecheck
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Typecheck (no TS project yet)
        shell: bash
        run: |
          set -euo pipefail
          echo "SKIP: no TypeScript project detected in repo root"

  test:
    name: test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Test (no test runner yet)
        shell: bash
        run: |
          set -euo pipefail
          echo "SKIP: no test suite detected in repo root"

  build:
    name: build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build (no build target yet)
        shell: bash
        run: |
          set -euo pipefail
          echo "SKIP: no build target detected in repo root"
